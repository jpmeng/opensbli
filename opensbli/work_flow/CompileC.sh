##@brief compile generated OPS C/C++ code
##@author Jianping Meng
##@contributors
##@details
#!/bin/bash

if [ $# -ne 2 ]
then
    echo "This script will compile the C/C++ code generated by OpenSBLI!"
    echo "Usage: ./CompileC.sh"
    echo "EnvDir: the directory for the environment."
    echo "Machine type: Ubuntu ARCHER2"
    echo "The compiling process needs Python3!"
    exit 1
fi
machine=$2
EnvDir=$1
if [ $machine == "ARCHER2" ]
then
    module purge PrgEnv-cray
    module load load-epcc-module
    module load cmake/3.21.3
    module load PrgEnv-gnu
    module load cray-hdf5-parallel
fi
# if [ $machine == "Ubuntu" ]
# then
#     sudo apt install libhdf5-openmpi-dev libhdf5-mpi-dev build-essential
# fi
cp $EnvDir/CMakeLists.txt .
mkdir build
cd build
cmake ../ -DOPS_INSTALL_DIR=$EnvDir/OPS-INSTALL -DOPS_TEST=OFF -DAPP_INSTALL_DIR=$HOME/OPS-APP -DGPU_NUMBER=1
cmake --build . -j 4
